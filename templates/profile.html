{% extends "base.html" %}
{% block content %}
<div class="container-fluid p-0">
    <div class="profile-header">
        <!-- Banner -->
        <div class="profile-banner" {% if current_user.banner %}style="background-image: url('{{ current_user.banner }}')"{% endif %}>
            <form method="POST" action="{{ url_for('update_banner') }}" enctype="multipart/form-data" class="banner-upload">
                <input type="file" id="banner" name="banner" accept="image/*" class="d-none">
                <label for="banner" class="banner-edit-btn">
                    <i class="fas fa-camera"></i>
                </label>
            </form>
        </div>
        
        <!-- Avatar -->
        <div class="profile-avatar-container">
            <div class="profile-avatar" {% if current_user.avatar %}style="background-image: url('{{ current_user.avatar }}')"{% endif %}>
                <form method="POST" action="{{ url_for('update_avatar') }}" enctype="multipart/form-data" class="avatar-upload">
                    <input type="file" id="avatar" name="avatar" accept="image/*" class="d-none">
                    <label for="avatar" class="avatar-edit-btn">
                        <i class="fas fa-camera"></i>
                    </label>
                </form>
            </div>
            <div class="presence-indicator {{ current_user.presence_state }}"></div>
        </div>
    </div>

    <div class="profile-content" {% if current_user.accent_color %}style="--accent-color: {{ current_user.accent_color }}"{% endif %}>
        <!-- User Info Section -->
        <div class="user-info-section">
            <div class="d-flex align-items-center">
                <h2 class="display-name">{{ current_user.display_name or current_user.username }}</h2>
                <span class="username text-muted">#{{ current_user.username }}</span>
            </div>
            
            <!-- Roles -->
            <div class="roles-container">
                {% for role in current_user.roles %}
                <span class="role-badge" style="background-color: {{ role.color }}">{{ role.name }}</span>
                {% endfor %}
            </div>

            <!-- Custom Status -->
            <div class="custom-status-section">
                <form method="POST" action="{{ url_for('update_status') }}" class="status-form">
                    <div class="input-group">
                        <button type="button" class="btn btn-emoji" data-bs-toggle="modal" data-bs-target="#emojiModal">
                            {% if current_user.status_emoji %}
                            <span class="status-emoji">{{ current_user.status_emoji }}</span>
                            {% else %}
                            <i class="far fa-smile"></i>
                            {% endif %}
                        </button>
                        <input type="text" name="status" class="form-control status-input" 
                               value="{{ current_user.status or '' }}" 
                               placeholder="Set a custom status">
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>

            <!-- About Me -->
            <div class="about-me-section">
                <h3>About Me</h3>
                <form method="POST" action="{{ url_for('update_bio') }}">
                    <textarea name="bio" class="form-control" rows="3" 
                              placeholder="Write a little bit about yourself">{{ current_user.bio or '' }}</textarea>
                    <button type="submit" class="btn btn-primary mt-2">Save</button>
                </form>
            </div>

            <!-- Activity -->
            <div class="activity-section">
                <h3>Activity</h3>
                <form method="POST" action="{{ url_for('update_activity') }}">
                    <div class="input-group">
                        <select name="activity_type" class="form-select">
                            <option value="">Select activity type</option>
                            <option value="playing" {% if current_user.activity_type == 'playing' %}selected{% endif %}>Playing</option>
                            <option value="streaming" {% if current_user.activity_type == 'streaming' %}selected{% endif %}>Streaming</option>
                            <option value="listening" {% if current_user.activity_type == 'listening' %}selected{% endif %}>Listening to</option>
                            <option value="watching" {% if current_user.activity_type == 'watching' %}selected{% endif %}>Watching</option>
                        </select>
                        <input type="text" name="activity_name" class="form-control"
                               value="{{ current_user.activity_name or '' }}"
                               placeholder="What are you doing?">
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>

            <!-- Connections -->
            <div class="connections-section">
                <h3>Connections</h3>
                <form method="POST" action="{{ url_for('update_connections') }}">
                    {% for platform in ['github', 'twitter', 'spotify', 'steam', 'xbox', 'playstation'] %}
                    <div class="connection-item">
                        <i class="fab fa-{{ platform }}"></i>
                        <input type="text" name="{{ platform }}" 
                               value="{{ current_user.connections.get(platform, '') }}"
                               placeholder="Add your {{ platform|title }} username">
                    </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-primary mt-2">Save Connections</button>
                </form>
            </div>

            <!-- Theme Settings -->
            <div class="theme-section">
                <h3>Appearance</h3>
                <form method="POST" action="{{ url_for('update_theme') }}">
                    <div class="color-picker-container">
                        <label>Accent Color</label>
                        <input type="color" name="accent_color" 
                               value="{{ current_user.accent_color or '#5865F2' }}"
                               class="form-control form-control-color">
                    </div>
                    <div class="theme-selector">
                        <label>Theme</label>
                        <select name="profile_theme" class="form-select">
                            <option value="dark" {% if current_user.profile_theme == 'dark' %}selected{% endif %}>Dark</option>
                            <option value="light" {% if current_user.profile_theme == 'light' %}selected{% endif %}>Light</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary mt-2">Save Appearance</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Emoji Picker Modal -->
<div class="modal fade" id="emojiModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Emoji</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="emoji-picker">
                    <!-- Emoji picker content will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}